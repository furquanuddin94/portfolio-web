---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import Pagination from '../../components/Pagination.astro';
import { getCollection } from 'astro:content';

const POSTS_PER_PAGE = 9;

const allPosts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime());

const currentPage = 1;
const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
const paginatedPosts = allPosts.slice(0, POSTS_PER_PAGE);
---

<BaseLayout
  title="Blog - Furquan Uddin"
  description="Building distributed systems at scale and exploring GenAI applications."
>
  <section class="container-custom py-12">
    <header class="mb-12">
      <h1 class="text-4xl font-bold tracking-tight text-zinc-700 dark:text-zinc-200 sm:text-5xl">
        Blog
      </h1>
      <p class="mt-4 text-xl text-zinc-600 dark:text-zinc-400">
        Thoughts, tutorials, and stories from my journey in tech.
      </p>
    </header>

    {paginatedPosts.length > 0 && (
      <>
        <div class="flex flex-col gap-4">
          {paginatedPosts.map((post) => (
            <PostCard
              slug={post.slug}
              title={post.data.title}
              description={post.data.description}
              publishDate={post.data.publishDate}
              tags={post.data.tags}
            />
          ))}
        </div>

        {totalPages > 1 && (
          <div class="mt-12">
            <Pagination
              currentPage={currentPage}
              lastPage={totalPages}
              urlPattern="/blog/[page]"
            />
          </div>
        )}
      </>
    )}
  </section>
</BaseLayout>

